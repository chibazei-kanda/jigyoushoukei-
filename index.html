
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>事業承継シミュレーション</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden { display: none; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  <div class="max-w-xl mx-auto p-4 bg-white shadow-lg mt-6 rounded-lg">
    <h1 class="text-2xl font-bold text-center mb-4">事業承継シミュレーション</h1>
    <div id="step-indicator" class="text-sm text-right mb-2">1 / 10</div>
    <div id="simForm">
      <div class="step" id="step-1">
        <label class="block mb-2 font-semibold">現在の年間売上高（万円）</label>
        <input type="number" id="sales" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-2">
        <label class="block mb-2 font-semibold">承継後売上減少率（％）</label>
        <input type="number" id="decline_rate" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-3">
        <label class="block mb-2 font-semibold">顧客流出率（％）</label>
        <input type="number" id="loss_rate" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-4">
        <label class="block mb-2 font-semibold">採用人数</label>
        <input type="number" id="hire_count" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-5">
        <label class="block mb-2 font-semibold">1人あたり採用費（万円）</label>
        <input type="number" id="hire_cost" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-6">
        <label class="block mb-2 font-semibold">1人あたり研修費（万円）</label>
        <input type="number" id="training_cost" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-7">
        <label class="block mb-2 font-semibold">専門家報酬（万円）</label>
        <input type="number" id="consult_fee" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-8">
        <label class="block mb-2 font-semibold">リスク想定額（万円）</label>
        <input type="number" id="risk_buffer" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-9">
        <label class="block mb-2 font-semibold">その他費用（万円）</label>
        <input type="number" id="other_costs" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="step hidden" id="step-10">
        <label class="block mb-2 font-semibold">経常利益率（％）</label>
        <input type="number" id="profit_rate" class="w-full border rounded px-3 py-2 mb-4" />
      </div>
      <div class="flex justify-between mt-4">
        <button type="button" id="prevBtn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded" disabled>戻る</button>
        <button type="button" id="nextBtn" class="px-4 py-2 bg-blue-500 text-white rounded">次へ</button>
      </div>
    </div>
    <div id="result" class="mt-6 p-4 bg-green-100 rounded hidden">
      <h2 class="text-lg font-bold mb-2">シミュレーション結果</h2>
      <p>損益回収に必要な年数：<strong id="payback_years"></strong> 年</p>
      <p id="scenario_summary" class="mt-2 text-sm text-gray-700"></p>
    </div>
  </div>
  <script>
    const steps = document.querySelectorAll('.step');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const stepIndicator = document.getElementById('step-indicator');
    const resultDiv = document.getElementById('result');
    let currentStep = 0;

    function showStep(index) {
      steps.forEach((step, i) => {
        step.classList.toggle('hidden', i !== index);
      });
      stepIndicator.textContent = \`\${index + 1} / \${steps.length}\`;
      prevBtn.disabled = index === 0;
      nextBtn.textContent = index === steps.length - 1 ? '計算する' : '次へ';
    }

    nextBtn.addEventListener('click', () => {
      const currentInputs = steps[currentStep].querySelectorAll('input');
      for (const input of currentInputs) {
        if (!input.value) {
          alert('すべての項目を入力してください');
          return;
        }
      }

      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep(currentStep);
      } else {
        calculateResult();
      }
    });

    prevBtn.addEventListener('click', () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    });

    function calculateResult() {
      const getVal = id => parseFloat(document.getElementById(id).value) || 0;
      const sales = getVal('sales');
      const decline = getVal('decline_rate');
      const hireCount = getVal('hire_count');
      const hireCost = getVal('hire_cost');
      const trainingCost = getVal('training_cost');
      const consultFee = getVal('consult_fee');
      const riskBuffer = getVal('risk_buffer');
      const otherCosts = getVal('other_costs');
      const profitRate = getVal('profit_rate');

      const cost = (hireCount * (hireCost + trainingCost)) + consultFee + riskBuffer + otherCosts;
      const reducedSales = sales * (1 - decline / 100);
      const annualProfit = reducedSales * (profitRate / 100);
      const years = (annualProfit > 0) ? (cost / annualProfit).toFixed(2) : '回収不能';

      document.getElementById('payback_years').textContent = years;

      let summary = '';
      if (annualProfit <= 0) {
        summary = "この条件では利益が見込めず、承継の経済合理性は低いです。";
      } else if (years <= 1.5) {
        summary = \`約 \${years} 年で初期費用を回収でき、有望といえます。\`;
      } else if (years <= 3) {
        summary = \`約 \${years} 年で回収可能ですが、慎重な判断が必要です。\`;
      } else {
        summary = \`\${years} 年以上かかる見込みであり、再検討が必要です。\`;
      }

      document.getElementById('scenario_summary').textContent = summary;
      resultDiv.classList.remove('hidden');
    }

    showStep(currentStep);
  </script>
</body>
</html>
